#!/usr/bin/env ruby

require 'rubygems'

if !ARGV[0]
  puts "Please specify a BleakHouse logfile"
  exit
else
  $LOAD_PATH << "#{File.dirname(__FILE__)}/../lib/"
  require 'bleak_house/analyzer'

  require 'ruby-debug' if ENV['DEBUG']

  if ENV['WATCH_MEM']
    Thread.new do
      while sleep(10)
        free = `free -m`.split("\n")[2].split(" ")[3].to_i
        if free < 20
          exit!
        end
      end
    end
  end

  BleakHouse::Analyzer.run(ARGV[0])
end
