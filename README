
BleakHouse

A library for finding memory leaks. 

== License

Copyright 2007 Cloudburst, LLC. See the included LICENSE file. Portions copyright 2006 Eric Hodel and used with permission. See the included LICENSE_BSD file. Portions copyright 2007 TOMITA Masahiro and used with permission. See the included LICENSE_RUBY file.

The public certificate for this gem is at http://rubyforge.org/frs/download.php/25331/evan_weaver-original-public_cert.pem.

== Features

* leak-proof C instrumentation
* fast logging
* complete tracking of object and symbol history
* easy Rails integration

== Requirements

* A unix-like operating system
* Ruby 1.8.6

= Usage

== Installation

Install the gem:
  sudo gem install bleak_house -v 3.0.1

You need to compile the BleakHouse patched Ruby build. In the plugin directory, run:
  rake ruby:build
  
This gives you a Ruby binary named <tt>ruby-bleak-house</tt> alongside your regular binary.

== Profiling a Rails app

To setup a Rails app for profiling, just <tt>require 'bleak_house'</tt> in <tt>config/environment.rb</tt>.

Then, to engage the logger (ideally, in a live deployment situation), start a server instance as so:
  RAILS_ENV=production BLEAK_HOUSE=true ruby-bleak-house ./script/server 

Browse around manually, thrash your entire app with a script, target troublesome controllers/actions, etc. The BleakHouse logger will dump a huge amount of data to <tt>log/bleak_house_production.dump</tt>--keep an eye on your disk space.

Then, to analyze the dump:
  bleak path/to/log/bleak_house_production.dump
  
Be patient.

= Extras

== Using BleakHouse outside of Rails

Just instantiate a BleakHouse::Logger object, and make calls to <tt>snapshot</tt> at appropriate times.

== Troubleshooting

If you see the error <tt>Symbol not found: _rb_gc_heaps_used</tt>, it means you installed the patched binary, but tried to profile the server with the regular Ruby binary.

You may get library require errors if you install <tt>ruby-bleak-house</tt> 1.8.6 alongside a different verson of Ruby. You could try to patch your local version of Ruby instead, or you could just upgrade to 1.8.6, which has a good trackrecord of stability.

== Reporting problems

* http://rubyforge.org/forum/forum.php?forum_id=13983

Patches and contributions are very welcome. Please note that contributors are required to assign copyright for their additions to Cloudburst, LLC.

== Further resources

* http://blog.evanweaver.com/articles/2007/05/12/let-me-hit-you-with-some-knowledge
* http://blog.evanweaver.com/articles/2007/05/06/leak-proof-direct-heap-instrumentation-for-bleak_house
* http://blog.evanweaver.com/articles/2007/04/28/bleak_house

